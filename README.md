# BP Insight

基于浏览器的静态血压记录与可视化工具，无需后台，即可在 GitHub Pages 上部署使用。用户可以录入单条或批量的血压读数，系统自动计算脉压（PP）、平均动脉压（MAP）、分级以及体位性低血压提示，并通过表格和 ECharts 图表进行交互式展示。所有数据仅存储在浏览器本地 `localStorage` 中，可一键导出为 CSV/JSON 或打印为矢量图表，无任何位图导出按钮。

## 功能特性

- **数据录入**：支持单条录入 SBP、DBP、HR、体位、症状、用药及备注；时间戳自动填充，可修改。
- **批量导入**：点击“批量粘贴 CSV”后，粘贴符合表头（ts,sbp,dbp,hr,posture,symptoms,meds,note）的 CSV 字符串即可批量导入。
- **指标计算**：根据收缩压和舒张压计算脉压 PP（SBP - DBP）和平均动脉压 MAP = (SBP + 2×DBP)/3，并依据常用标准判断分级：
  - 低血压：SBP < 90 或 DBP < 60
  - 正常：SBP < 120 且 DBP < 80
  - 升高：SBP 120–129 且 DBP < 80
  - 1 级高血压：SBP 130–139 或 DBP 80–89
  - 2 级高血压：SBP ≥ 140 或 DBP ≥ 90
  - 危象：SBP ≥ 180 或 DBP ≥ 120（界面高亮）
- **体位性低血压识别**：当连续的卧位与站立记录满足 SBP 下降 ≥20 mmHg 或 DBP 下降 ≥10 mmHg 时，在表格中标记“是”。
- **表格与排序**：历史记录表可点击表头按时间、SBP、DBP 或 HR 升降序排列；体位对照表显示卧位与站立差值。
- **图表可视化**：
  - **折线图**：按时间展示 SBP/DBP/HR，可切换 7 天、30 天或全部数据。
  - **柱状图**：展示一天内不同时段（上午、下午、晚上、夜间）的平均 SBP/DBP。
  - **子弹图**：最新一次 MAP 值在参考范围内的位置指示。
  所有图表均使用 Apache ECharts 的 SVG 渲染器，实现打印友好、矢量输出。
- **数据导出与打印**：可导出为 `CSV` 或 `JSON`；内置打印样式，打印时仅显示表格与图表并使用黑白高对比度。
- **本地存储与安全**：所有数据保存在浏览器的 `localStorage` 中，任何网络请求均不包含用户数据；支持“一键清空”。
- **可访问性**：移动端自适应布局，键盘可操作，并提供 ARIA 标签及足够对比度。颜色方案遵循蓝/绿/黄/橙/红/深红顺序，打印时自动降噪。

## 使用方法

1. 访问部署好的 GitHub Pages 地址（首次部署后将在仓库设置中启用 gh-pages）。
2. 在“新增读数”表单中填入时间戳、SBP、DBP 等信息；可点击“添加药物”录入用药情况；症状可多选。
3. 点击“保存读数”后数据将存入浏览器并立即更新概览卡片、表格和图表。
4. 如需批量导入历史数据，可点击“批量粘贴 CSV”，按照 `ts,sbp,dbp,hr,posture,symptoms,meds,note` 的表头格式粘贴文本。
5. 点击“导出 CSV”或“导出 JSON”即可下载当前全部数据；点击“清空数据”可删除本地所有记录。
6. 打印时使用浏览器自带的打印功能，页面将自动应用 A4 纵向排版并保留表格与 SVG 图表。

## 阈值来源

分级阈值参考自《美国心脏协会》及《世界卫生组织》公开指南，适用于成人血压的初步分级。体位性低血压判断采用常见临床标准：卧位与站立 SBP 下降 ≥20 mmHg 或 DBP 下降 ≥10 mmHg。该工具仅用于教育与信息展示，无法替代临床诊断。

## 免责声明

**本工具仅用于信息展示与教育，不构成诊断或治疗建议。任何血压异常或出现紧急症状（如胸痛、呼吸困难、神经症状等）请立即就医。** 所有数据在用户浏览器端保存，不会上传至第三方。

## 打印说明

页面内置打印样式，适用于 A4 纵向。打印时自动隐藏输入表单、交互按钮，仅保留表格和 SVG 矢量图表，并使用黑白高对比度。可通过浏览器“打印”或“保存为 PDF”功能进行导出。

## 测试用例

建议在使用前尝试以下最小用例，检查分级是否符合预期：

| SBP/DBP | 预期分级   |
|---------|------------|
| 118/76  | 正常        |
| 125/78  | 升高        |
| 135/85  | 1 级        |
| 155/95  | 2 级        |
| 85/55   | 低血压      |
| 190/122 | 危象        |

此外，体位用例：先录入卧位 120/75，再录入站立 96/64，应提示触发体位性低血压。

## 目录结构

```
/
├── index.html           # 主页面
├── css/styles.css       # 样式表
├── js/app.js            # 数据校验、状态管理、本地存储
├── js/charts.js         # ECharts 图表配置
├── js/tables.js         # 表格渲染与排序
├── assets/              # 图标、示例 CSV（可自行添加）
├── tests/               # 最小化前端用例（可
拓展）
└── .github/workflows/deploy.yml # GitHub Actions 自动部署配置
```

## 部署说明

仓库默认分支为 `main`，每次 push 后 GitHub Actions 自动将当前目录构建并发布到 `gh-pages` 分支。首次部署后，请在仓库设置中启用 GitHub Pages，选择 `gh-pages` 分支作为源码路径，即可访问在线页面。
